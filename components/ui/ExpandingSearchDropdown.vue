<template>
  <div class="expanding-search-dropdown">
    <!-- Header with Filters -->
    <div class="search-dropdown-header">
      <div class="search-dropdown-title">Search Settings</div>
      <div class="search-dropdown-filters">
        <select 
          v-model="selectedCountry" 
          class="search-dropdown-country"
        >
          <option value="TR">ğŸ‡¹ğŸ‡· TÃ¼rkiye</option>
          <option value="US">ğŸ‡ºğŸ‡¸ Amerika</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ Ä°ngiltere</option>
          <option value="DE">ğŸ‡©ğŸ‡ª Almanya</option>
          <option value="FR">ğŸ‡«ğŸ‡· Fransa</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ Ä°talya</option>
          <option value="ES">ğŸ‡ªğŸ‡¸ Ä°spanya</option>
          <option value="NL">ğŸ‡³ğŸ‡± Hollanda</option>
          <option value="BE">ğŸ‡§ğŸ‡ª BelÃ§ika</option>
          <option value="AT">ğŸ‡¦ğŸ‡¹ Avusturya</option>
          <option value="CH">ğŸ‡¨ğŸ‡­ Ä°sviÃ§re</option>
          <option value="SE">ğŸ‡¸ğŸ‡ª Ä°sveÃ§</option>
          <option value="NO">ğŸ‡³ğŸ‡´ NorveÃ§</option>
          <option value="DK">ğŸ‡©ğŸ‡° Danimarka</option>
          <option value="FI">ğŸ‡«ğŸ‡® Finlandiya</option>
          <option value="PL">ğŸ‡µğŸ‡± Polonya</option>
          <option value="CZ">ğŸ‡¨ğŸ‡¿ Ã‡ek Cumhuriyeti</option>
          <option value="HU">ğŸ‡­ğŸ‡º Macaristan</option>
          <option value="RO">ğŸ‡·ğŸ‡´ Romanya</option>
          <option value="BG">ğŸ‡§ğŸ‡¬ Bulgaristan</option>
          <option value="HR">ğŸ‡­ğŸ‡· HÄ±rvatistan</option>
          <option value="SI">ğŸ‡¸ğŸ‡® Slovenya</option>
          <option value="SK">ğŸ‡¸ğŸ‡° Slovakya</option>
          <option value="LT">ğŸ‡±ğŸ‡¹ Litvanya</option>
          <option value="LV">ğŸ‡±ğŸ‡» Letonya</option>
          <option value="EE">ğŸ‡ªğŸ‡ª Estonya</option>
          <option value="CA">ğŸ‡¨ğŸ‡¦ Kanada</option>
          <option value="AU">ğŸ‡¦ğŸ‡º Avustralya</option>
          <option value="NZ">ğŸ‡³ğŸ‡¿ Yeni Zelanda</option>
          <option value="BR">ğŸ‡§ğŸ‡· Brezilya</option>
          <option value="AR">ğŸ‡¦ğŸ‡· Arjantin</option>
          <option value="MX">ğŸ‡²ğŸ‡½ Meksika</option>
          <option value="CL">ğŸ‡¨ğŸ‡± Åili</option>
          <option value="CO">ğŸ‡¨ğŸ‡´ Kolombiya</option>
          <option value="PE">ğŸ‡µğŸ‡ª Peru</option>
          <option value="VE">ğŸ‡»ğŸ‡ª Venezuela</option>
          <option value="UY">ğŸ‡ºğŸ‡¾ Uruguay</option>
          <option value="PY">ğŸ‡µğŸ‡¾ Paraguay</option>
          <option value="EC">ğŸ‡ªğŸ‡¨ Ekvador</option>
          <option value="BO">ğŸ‡§ğŸ‡´ Bolivya</option>
          <option value="GY">ğŸ‡¬ğŸ‡¾ Guyana</option>
          <option value="SR">ğŸ‡¸ğŸ‡· Surinam</option>
          <option value="GF">ğŸ‡¬ğŸ‡« FransÄ±z GuyanasÄ±</option>
          <option value="FK">ğŸ‡«ğŸ‡° Falkland AdalarÄ±</option>
          <option value="JP">ğŸ‡¯ğŸ‡µ Japonya</option>
          <option value="KR">ğŸ‡°ğŸ‡· GÃ¼ney Kore</option>
          <option value="CN">ğŸ‡¨ğŸ‡³ Ã‡in</option>
          <option value="IN">ğŸ‡®ğŸ‡³ Hindistan</option>
          <option value="TH">ğŸ‡¹ğŸ‡­ Tayland</option>
          <option value="VN">ğŸ‡»ğŸ‡³ Vietnam</option>
          <option value="MY">ğŸ‡²ğŸ‡¾ Malezya</option>
          <option value="SG">ğŸ‡¸ğŸ‡¬ Singapur</option>
          <option value="ID">ğŸ‡®ğŸ‡© Endonezya</option>
          <option value="PH">ğŸ‡µğŸ‡­ Filipinler</option>
          <option value="TW">ğŸ‡¹ğŸ‡¼ Tayvan</option>
          <option value="HK">ğŸ‡­ğŸ‡° Hong Kong</option>
          <option value="MO">ğŸ‡²ğŸ‡´ Makao</option>
          <option value="RU">ğŸ‡·ğŸ‡º Rusya</option>
          <option value="UA">ğŸ‡ºğŸ‡¦ Ukrayna</option>
          <option value="BY">ğŸ‡§ğŸ‡¾ Belarus</option>
          <option value="MD">ğŸ‡²ğŸ‡© Moldova</option>
          <option value="GE">ğŸ‡¬ğŸ‡ª GÃ¼rcistan</option>
          <option value="AM">ğŸ‡¦ğŸ‡² Ermenistan</option>
          <option value="AZ">ğŸ‡¦ğŸ‡¿ Azerbaycan</option>
          <option value="KZ">ğŸ‡°ğŸ‡¿ Kazakistan</option>
          <option value="UZ">ğŸ‡ºğŸ‡¿ Ã–zbekistan</option>
          <option value="KG">ğŸ‡°ğŸ‡¬ KÄ±rgÄ±zistan</option>
          <option value="TJ">ğŸ‡¹ğŸ‡¯ Tacikistan</option>
          <option value="TM">ğŸ‡¹ğŸ‡² TÃ¼rkmenistan</option>
          <option value="AF">ğŸ‡¦ğŸ‡« Afganistan</option>
          <option value="PK">ğŸ‡µğŸ‡° Pakistan</option>
          <option value="BD">ğŸ‡§ğŸ‡© BangladeÅŸ</option>
          <option value="LK">ğŸ‡±ğŸ‡° Sri Lanka</option>
          <option value="NP">ğŸ‡³ğŸ‡µ Nepal</option>
          <option value="BT">ğŸ‡§ğŸ‡¹ Bhutan</option>
          <option value="MV">ğŸ‡²ğŸ‡» Maldivler</option>
          <option value="MM">ğŸ‡²ğŸ‡² Myanmar</option>
          <option value="LA">ğŸ‡±ğŸ‡¦ Laos</option>
          <option value="KH">ğŸ‡°ğŸ‡­ KamboÃ§ya</option>
          <option value="MN">ğŸ‡²ğŸ‡³ MoÄŸolistan</option>
          <option value="KP">ğŸ‡°ğŸ‡µ Kuzey Kore</option>
          <option value="IL">ğŸ‡®ğŸ‡± Ä°srail</option>
          <option value="LB">ğŸ‡±ğŸ‡§ LÃ¼bnan</option>
          <option value="SY">ğŸ‡¸ğŸ‡¾ Suriye</option>
          <option value="JO">ğŸ‡¯ğŸ‡´ ÃœrdÃ¼n</option>
          <option value="IQ">ğŸ‡®ğŸ‡¶ Irak</option>
          <option value="IR">ğŸ‡®ğŸ‡· Ä°ran</option>
          <option value="KW">ğŸ‡°ğŸ‡¼ Kuveyt</option>
          <option value="SA">ğŸ‡¸ğŸ‡¦ Suudi Arabistan</option>
          <option value="AE">ğŸ‡¦ğŸ‡ª BirleÅŸik Arap Emirlikleri</option>
          <option value="QA">ğŸ‡¶ğŸ‡¦ Katar</option>
          <option value="BH">ğŸ‡§ğŸ‡­ Bahreyn</option>
          <option value="OM">ğŸ‡´ğŸ‡² Umman</option>
          <option value="YE">ğŸ‡¾ğŸ‡ª Yemen</option>
          <option value="EG">ğŸ‡ªğŸ‡¬ MÄ±sÄ±r</option>
          <option value="LY">ğŸ‡±ğŸ‡¾ Libya</option>
          <option value="TN">ğŸ‡¹ğŸ‡³ Tunus</option>
          <option value="DZ">ğŸ‡©ğŸ‡¿ Cezayir</option>
          <option value="MA">ğŸ‡²ğŸ‡¦ Fas</option>
          <option value="SD">ğŸ‡¸ğŸ‡© Sudan</option>
          <option value="SS">ğŸ‡¸ğŸ‡¸ GÃ¼ney Sudan</option>
          <option value="ET">ğŸ‡ªğŸ‡¹ Etiyopya</option>
          <option value="ER">ğŸ‡ªğŸ‡· Eritre</option>
          <option value="DJ">ğŸ‡©ğŸ‡¯ Cibuti</option>
          <option value="SO">ğŸ‡¸ğŸ‡´ Somali</option>
          <option value="KE">ğŸ‡°ğŸ‡ª Kenya</option>
          <option value="UG">ğŸ‡ºğŸ‡¬ Uganda</option>
          <option value="TZ">ğŸ‡¹ğŸ‡¿ Tanzanya</option>
          <option value="RW">ğŸ‡·ğŸ‡¼ Ruanda</option>
          <option value="BI">ğŸ‡§ğŸ‡® Burundi</option>
          <option value="MZ">ğŸ‡²ğŸ‡¿ Mozambik</option>
          <option value="ZW">ğŸ‡¿ğŸ‡¼ Zimbabve</option>
          <option value="ZM">ğŸ‡¿ğŸ‡² Zambiya</option>
          <option value="MW">ğŸ‡²ğŸ‡¼ Malavi</option>
          <option value="BW">ğŸ‡§ğŸ‡¼ Botsvana</option>
          <option value="NA">ğŸ‡³ğŸ‡¦ Namibya</option>
          <option value="ZA">ğŸ‡¿ğŸ‡¦ GÃ¼ney Afrika</option>
          <option value="LS">ğŸ‡±ğŸ‡¸ Lesotho</option>
          <option value="SZ">ğŸ‡¸ğŸ‡¿ Eswatini</option>
          <option value="MG">ğŸ‡²ğŸ‡¬ Madagaskar</option>
          <option value="MU">ğŸ‡²ğŸ‡º Mauritius</option>
          <option value="SC">ğŸ‡¸ğŸ‡¨ SeyÅŸeller</option>
          <option value="KM">ğŸ‡°ğŸ‡² Komorlar</option>
          <option value="TD">ğŸ‡¹ğŸ‡© Ã‡ad</option>
          <option value="CF">ğŸ‡¨ğŸ‡« Orta Afrika Cumhuriyeti</option>
          <option value="CM">ğŸ‡¨ğŸ‡² Kamerun</option>
          <option value="GQ">ğŸ‡¬ğŸ‡¶ Ekvator Ginesi</option>
          <option value="GA">ğŸ‡¬ğŸ‡¦ Gabon</option>
          <option value="CG">ğŸ‡¨ğŸ‡¬ Kongo Cumhuriyeti</option>
          <option value="CD">ğŸ‡¨ğŸ‡© Demokratik Kongo Cumhuriyeti</option>
          <option value="AO">ğŸ‡¦ğŸ‡´ Angola</option>
          <option value="ST">ğŸ‡¸ğŸ‡¹ SÃ£o TomÃ© ve PrÃ­ncipe</option>
          <option value="GW">ğŸ‡¬ğŸ‡¼ Gine-Bissau</option>
          <option value="GN">ğŸ‡¬ğŸ‡³ Gine</option>
          <option value="SL">ğŸ‡¸ğŸ‡± Sierra Leone</option>
          <option value="LR">ğŸ‡±ğŸ‡· Liberya</option>
          <option value="CI">ğŸ‡¨ğŸ‡® FildiÅŸi Sahili</option>
          <option value="GH">ğŸ‡¬ğŸ‡­ Gana</option>
          <option value="TG">ğŸ‡¹ğŸ‡¬ Togo</option>
          <option value="BJ">ğŸ‡§ğŸ‡¯ Benin</option>
          <option value="NG">ğŸ‡³ğŸ‡¬ Nijerya</option>
          <option value="NE">ğŸ‡³ğŸ‡ª Nijer</option>
          <option value="BF">ğŸ‡§ğŸ‡« Burkina Faso</option>
          <option value="ML">ğŸ‡²ğŸ‡± Mali</option>
          <option value="SN">ğŸ‡¸ğŸ‡³ Senegal</option>
          <option value="GM">ğŸ‡¬ğŸ‡² Gambiya</option>
          <option value="CV">ğŸ‡¨ğŸ‡» YeÅŸil Burun</option>
          <option value="MR">ğŸ‡²ğŸ‡· Moritanya</option>
          <option value="EH">ğŸ‡ªğŸ‡­ BatÄ± Sahra</option>
        </select>
      </div>
    </div>

    <!-- Recent Searches -->
    <div v-if="!searchQuery && recentSearches.length > 0" class="recent-searches-section">
      <div class="recent-searches-title">
        Recently searched
        <button @click="clearRecentSearches" class="clear-recent-btn">Clear all</button>
      </div>
      <div class="recent-searches-grid">
        <div 
          v-for="search in recentSearches.slice(0, 6)" 
          :key="search.id"
          @click="selectRecentSearch(search)"
          class="recent-search-item"
        >
          <NuxtImg 
            :src="search.poster ? `https://image.tmdb.org/t/p/w200${search.poster}` : '/placeholder-movie.jpg'" 
            :alt="search.title"
            class="recent-search-poster"
            loading="lazy"
          />
          <div class="recent-search-title">{{ search.title }}</div>
        </div>
      </div>
    </div>

    <!-- Search Results -->
    <div v-if="searchQuery && searchResults.length > 0" class="search-results-dropdown">
      <div 
        v-for="result in searchResults.slice(0, 5)" 
        :key="result.id"
        @click="selectSearchResult(result)"
        class="search-result-dropdown-item"
      >
        <NuxtImg 
          :src="result.poster ? `https://image.tmdb.org/t/p/w200${result.poster}` : '/placeholder-movie.jpg'" 
          :alt="result.title"
          class="search-result-dropdown-poster"
          loading="lazy"
        />
        <div class="search-result-dropdown-info">
          <div class="search-result-dropdown-title">{{ result.title }}</div>
          <div class="search-result-dropdown-meta">{{ result.year }} â€¢ {{ result.type }}</div>
        </div>
        <div class="search-result-dropdown-type">{{ result.type }}</div>
      </div>
    </div>

    <!-- Selected Movie Providers -->
    <div v-if="selectedProviders.length > 0" class="providers-dropdown-section">
      <div class="providers-dropdown-title">Available on</div>
      <div class="providers-dropdown-grid">
        <div 
          v-for="provider in selectedProviders" 
          :key="provider.id"
          class="provider-dropdown-item"
        >
          <div class="provider-dropdown-logo" :style="{backgroundColor: provider.color}">
            {{ provider.name[0] }}
          </div>
          <span class="provider-dropdown-name">{{ provider.name }}</span>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div v-if="searchQuery && searchResults.length === 0" class="empty-dropdown-state">
      <div class="empty-dropdown-icon">ğŸ”</div>
      <div class="empty-dropdown-text">No results found</div>
      <div class="empty-dropdown-subtext">Try searching for a different title</div>
    </div>
  </div>
</template>

<script setup>
// Dumb component - receives props and emits events
const searchStore = useSearchStore()
const contentStore = useContentStore()
const { selectSearchResult, selectRecentSearch, clearRecentSearches, setSearchCountry } = useSearch()

const searchQuery = computed(() => searchStore.expandingSearchQuery)
const searchResults = computed(() => searchStore.expandingSearchResults)
const selectedProviders = computed(() => searchStore.selectedExpandingSearchProviders)
const recentSearches = computed(() => contentStore.recentSearches)

const selectedCountry = computed({
  get: () => searchStore.expandingSearchCountry,
  set: (value) => setSearchCountry(value)
})
</script> 